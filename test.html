<!-- <!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Jadwal Sholat</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/select/4.0.13/css/select.min.css"
      rel="stylesheet"
    />
   <style>
 body.dark-mode {
    background-color: #121212;
    color: white;
}

table.dark-mode {
    background-color: #1e1e1e;
    color: white;
    border-color: white;
}

table.dark-mode th {
    background-color: #1a7288;
    color: white;
}

table.dark-mode td {
    border-color: white;
}

.row{
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
    margin-bottom: 15px;
}
        @media (max-width: 768px) {
            select {
                width: 80%;
                max-width: 250px;
                text-align: left;
            }
        }

select {
    width: 55vh;
    padding: 10px;
    font-size: 16px;
    border-radius: 5px;
    border: 1px solid #ccc;
    box-sizing: border-box;
}

.select-container .select-selection--single {
    text-align: left !important;
}

.select-container .select-results__option {
    text-align: left !important;
}

body.dark-mode .select-container .select-results__option {
    color: black; /* Warna teks di mode gelap */
    background-color: white; /* Latar belakang lebih gelap */
}


.table-container {
    max-height: 400px;
    border: 1px solid #ddd;
    position: relative;
    width: 100%;
}

table {
    width: 100%;
    background: white;
    border-radius: 10px;
    border-collapse: collapse;
    transition: background 0.3s ease, color 0.3s ease;
}

th,
td {
    border: 1px solid #ddd;
    padding: 10px;
    text-align: center;
    white-space: nowrap;
}

th {
    background-color: #1a7288;
    color: white;
    position: sticky;
    top: 0;
    z-index: 100;
}

thead {
    position: sticky;
    top: 0;
    background-color: #1a7288;
    color: white;
    z-index: 100;
}

.header-section{
    color: #1a7288;
    text-align: center;
}

#judul-jadwal {
    padding: 10px;
    border-radius: 5px;
    font-weight: bold;
    font-size: 20px;
    margin: 0;
    text-align: center;
}

.formattedToday {
    background-color: #198754 !important;
    color: white;
}

.table-container::before {
    display: block;
    height: 50px;
    position: sticky;
    top: 0;
    background: white;
    z-index: 99;
}
</style>

  </head>
  <body>
    <header class="header-section">
      <h1>JADWAL SHOLAT & IMSAKIYAH SELURUH INDONESIA</h1>
    </header>
    <div class="container mt-4">
    <div class="row g-3">
         <div class="col-md-3" >
      <label for="city">Pilih Kota:</label>
      <select id="city" class="select"></select>
            </div>
    <div class="col-md-3">
      <label for="year">Pilih Tahun:</label>
      <select id="year" class="select"></select>
    </div>
    <div class="col-md-6">
      <label for="month">Pilih Bulan:</label>
      <select id="month" class="select"></select>  
    </div>
      </select>
    </div>
</div>
 <h2 id="judul-jadwal">JADWAL IMSAKIYAH</h2>
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>Tanggal</th>
            <th>Imsak</th>
            <th>Terbit</th>
            <th>Dhuha</th>
            <th>Subuh</th>
            <th>Dzuhur</th>
            <th>Ashar</th>
            <th>Maghrib</th>
            <th>Isya</th>
          </tr>
        </thead>
        <tbody id="schedule-body">
          <tr>
            <td colspan="7">Loading...</td>
          </tr>
        </tbody>
      </table>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select/4.0.13/js/select.min.js"></script>
  <script>
    function normalizeCityName(cityName) {
  return cityName
    .toLowerCase()
    .replace(/^(kota|city of)\s+/i, '') // Hilangkan "KOTA" atau "City of"
    .trim();
}

async function getUserLocation(cityList) {
  if ("geolocation" in navigator) {
    navigator.geolocation.getCurrentPosition(async (position) => {
      const latitude = position.coords.latitude;
      const longitude = position.coords.longitude;

      try {
        const response = await fetch(
          `https://nominatim.openstreetmap.org/reverse?lat=${latitude}&lon=${longitude}&format=json`
        );
        const data = await response.json();
        console.log("Data lokasi:", data);

        let userCity = data.address.city || data.address.town || data.address.village || data.address.county;

        console.log("Kota terdeteksi:", userCity);
if (userCity) {
  let normalizedUserCity = normalizeCityName(userCity);
  console.log("Nama kota setelah normalisasi:", normalizedUserCity);

  let matchedCity = cityList.find(city =>
    normalizeCityName(city.lokasi).includes(normalizedUserCity)
  );

  if (matchedCity) {
    console.log("Kota cocok dengan API:", matchedCity.lokasi);
    $("#city").val(matchedCity.id).trigger("change");
    getPrayerSchedule();
  } else {
    console.warn("Kota tidak ditemukan dalam daftar API, default ke Jakarta");
    $("#city").val("1301").trigger("change");
    getPrayerSchedule();
  }
}
 else {
  console.warn("Nama kota tidak ditemukan dalam data lokasi.");
}

      } catch (error) {
        console.error("Gagal mendapatkan lokasi:", error);
        alert("Gagal mendeteksi lokasi. Silakan pilih kota secara manual.");
      }
    }, (error) => {
      console.error("Geolocation error:", error.message);
      alert("Izin lokasi ditolak. Silakan pilih kota secara manual.");
    });
  } else {
    console.warn("Geolocation tidak didukung di browser ini.");
    alert("Browser Anda tidak mendukung geolokasi. Silakan pilih kota secara manual.");
  }
}

async function loadCities() {
  try {
    const response = await fetch("https://api.myquran.com/v2/sholat/kota/semua");
    const data = await response.json();
    const citySelect = $("#city");

    citySelect.empty();
    data.data.forEach((city) => {
      citySelect.append(new Option(city.lokasi, city.id));
    });

    $("#city").select({ placeholder: "Cari Kota/Kab.", allowClear: true });
    getUserLocation(data.data);
  } catch (error) {
    console.error("Gagal mengambil daftar kota:", error);
  }
}



function setCityBasedOnLocation(userCityName) {
  const citySelect = document.getElementById("city");
  let found = false;

  for (let option of citySelect.options) {
    if (option.text.toLowerCase().includes(userCityName.toLowerCase())) {
      citySelect.value = option.value;
      found = true;
      break;
    }
  }

  if (!found) {
    citySelect.value = "0228"; // Default ke Medan jika tidak ditemukan
  }

  citySelect.dispatchEvent(new Event("change")); // Memperbarui jadwal sholat
}



  function populateYearSelect() {
    const yearSelect = document.getElementById("year");
    const currentYear = new Date().getFullYear();
    for (let i = currentYear - 10; i <= currentYear + 5; i++) {
      let option = document.createElement("option");
      option.value = i;
      option.textContent = i;
      if (i === currentYear) {
        option.selected = true;
      }
      yearSelect.appendChild(option);
    }
  }

  function populateMonthSelect() {
    const monthSelect = document.getElementById("month");
    const monthNames = [
      "JANUARI", "FEBRUARI", "MARET", "APRIL", "MEI", "JUNI", 
      "JULI", "AGUSTUS", "SEPTEMBER", "OKTOBER", "NOVEMBER", "DESEMBER"
    ];
    const currentMonth = new Date().getMonth();
    monthNames.forEach((month, index) => {
      let option = document.createElement("option");
      option.value = String(index + 1).padStart(2, "0");
      option.textContent = month;
      if (index === currentMonth) {
        option.selected = true;
      }
      monthSelect.appendChild(option);
    });
  }

  async function getPrayerSchedule() {
    const citySelect = document.getElementById("city");
    const cityId = citySelect.value;
    const cityName = citySelect.options[citySelect.selectedIndex].text;
    const year = document.getElementById("year").value;
    const month = document.getElementById("month").value;
    const today = new Date();
    const formattedToday = today.getDate();

    const monthNames = ["JANUARI", "FEBRUARI", "MARET", "APRIL", "MEI", "JUNI", "JULI", "AGUSTUS", "SEPTEMBER", "OKTOBER", "NOVEMBER", "DESEMBER"];
    const monthName = monthNames[parseInt(month, 10) - 1];
    document.getElementById("judul-jadwal").textContent = `JADWAL IMSAKIYAH ${cityName} - ${monthName} ${year}`;

    const url = `https://api.myquran.com/v2/sholat/jadwal/${cityId}/${year}/${month}`;
    try {
      const response = await fetch(url);
      const data = await response.json();
      const tbody = document.getElementById("schedule-body");
      tbody.innerHTML = "";

      if (data.status && data.data && data.data.jadwal) {
        data.data.jadwal.forEach((item) => {
          const dateObj = new Date(item.date);
          const dayNumber = dateObj.getDate();
          const isToday = dayNumber === formattedToday;

          const row = document.createElement("tr");
          if (isToday) row.classList.add("formattedToday");

          row.innerHTML = `
            <td>${item.tanggal}</td>
            <td>${item.imsak}</td>
            <td>${item.terbit}</td>
            <td>${item.dhuha}</td>
            <td>${item.subuh}</td>
            <td>${item.dzuhur}</td>
            <td>${item.ashar}</td>
            <td>${item.maghrib}</td>
            <td>${item.isya}</td>
          `;
          tbody.appendChild(row);
        });
      } else {
        tbody.innerHTML = `<tr><td colspan="9">Data tidak ditemukan</td></tr>`;
      }
    } catch (error) {
      console.error("Gagal mengambil data:", error);
      document.getElementById("schedule-body").innerHTML = `<tr><td colspan="9">Gagal mengambil data</td></tr>`;
    }
  }

  function applyDarkMode() {
    const now = new Date();
    const hour = now.getHours();
    if (hour >= 18 || hour < 6) {
      document.body.classList.add("dark-mode");
      document.querySelector("table").classList.add("dark-mode");
    } else {
      document.body.classList.remove("dark-mode");
      document.querySelector("table").classList.remove("dark-mode");
    }
  }

  document.addEventListener("DOMContentLoaded", function () {
    populateYearSelect();
    populateMonthSelect();
    loadCities().then(getPrayerSchedule);
    applyDarkMode();
    setInterval(applyDarkMode, 3600000);
  });

  $(document).ready(function () {
    $("#city").select({ placeholder: "Pilih kota/kabupaten", allowClear: true });
    $("#city, #month, #year").on("change", getPrayerSchedule);
  });
</script> -->
